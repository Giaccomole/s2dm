# Specification History Registry Schema
# Version management and change tracking system

directive @range(min: Float, max: Float) on FIELD_DEFINITION
directive @cardinality(min: Int, max: Int) on FIELD_DEFINITION
directive @noDuplicates on FIELD_DEFINITION
directive @instanceTag on OBJECT
directive @metadata(comment: String, vssType: String) on FIELD_DEFINITION | OBJECT

scalar DateTime
scalar JSON

"""A specification registry containing multiple versions"""
type SpecificationRegistry {
  """Unique identifier for the registry"""
  id: ID!
  
  """Name of the specification"""
  name: String!
  
  """Description of what this specification covers"""
  description: String
  
  """Current active version"""
  currentVersion: SpecificationVersion!
  
  """All versions in chronological order"""
  versions: [SpecificationVersion!]!
  
  """Registry metadata"""
  metadata: RegistryMetadata
}

"""A specific version of a specification"""
type SpecificationVersion {
  """Unique identifier for this version"""
  id: ID!
  
  """Semantic version number (e.g., 1.2.3)"""
  version: String!
  
  """Human-readable version name"""
  versionName: String
  
  """The GraphQL schema for this version"""
  schema: String!
  
  """Commit hash or revision identifier"""
  revision: String
  
  """Creation timestamp"""
  createdAt: DateTime!
  
  """Author information"""
  author: String
  
  """Release notes"""
  releaseNotes: String
  
  """Tags associated with this version"""
  tags: [String!]
  
  """Is this a pre-release version?"""
  isPrerelease: Boolean!
  
  """Is this version deprecated?"""
  isDeprecated: Boolean!
  
  """Version metadata"""
  metadata: JSON
}

"""Change information between versions"""
type Change {
  """Unique identifier for the change"""
  id: ID!
  
  """Type of change"""
  type: ChangeType!
  
  """Severity/impact level"""
  severity: ChangeSeverity!
  
  """Human-readable description"""
  description: String!
  
  """Detailed explanation"""
  details: String
  
  """Path to the changed element"""
  path: String!
  
  """Old value (for modifications)"""
  oldValue: String
  
  """New value (for modifications)"""
  newValue: String
  
  """Affected components or consumers"""
  affectedComponents: [String!]
  
  """Migration guidance"""
  migrationGuide: String
  
  """Timestamp when change was detected"""
  detectedAt: DateTime!
}

enum ChangeType {
  FIELD_ADDED
  FIELD_REMOVED
  FIELD_MODIFIED
  TYPE_ADDED
  TYPE_REMOVED
  TYPE_MODIFIED
  ENUM_VALUE_ADDED
  ENUM_VALUE_REMOVED
  DIRECTIVE_ADDED
  DIRECTIVE_REMOVED
  DIRECTIVE_MODIFIED
  ARGUMENT_ADDED
  ARGUMENT_REMOVED
  ARGUMENT_MODIFIED
  DEPRECATION_ADDED
  DEPRECATION_REMOVED
}

enum ChangeSeverity {
  BREAKING
  DANGEROUS
  NON_BREAKING
  ADDITIVE
}

"""Comparison result between two versions"""
type VersionComparison {
  """Source version"""
  fromVersion: SpecificationVersion!
  
  """Target version"""
  toVersion: SpecificationVersion!
  
  """All detected changes"""
  changes: [Change!]!
  
  """Breaking changes only"""
  breakingChanges: [Change!]!
  
  """Dangerous changes only"""
  dangerousChanges: [Change!]!
  
  """Non-breaking changes only"""
  nonBreakingChanges: [Change!]!
  
  """Overall compatibility assessment"""
  compatibility: CompatibilityLevel!
  
  """Migration complexity score (1-10)"""
  migrationComplexity: Int!
  
  """Comparison timestamp"""
  comparedAt: DateTime!
}

enum CompatibilityLevel {
  FULLY_COMPATIBLE
  BACKWARD_COMPATIBLE
  PARTIALLY_COMPATIBLE
  INCOMPATIBLE
}

"""Registry metadata and configuration"""
type RegistryMetadata {
  """Registry creation date"""
  createdAt: DateTime!
  
  """Last update timestamp"""
  updatedAt: DateTime!
  
  """Registry maintainers"""
  maintainers: [String!]
  
  """Associated repository URL"""
  repositoryUrl: String
  
  """Documentation URL"""
  documentationUrl: String
  
  """License information"""
  license: String
  
  """Additional metadata"""
  customMetadata: JSON
}

"""Version history timeline entry"""
type VersionHistoryEntry {
  """The version"""
  version: SpecificationVersion!
  
  """Changes introduced in this version"""
  changes: [Change!]!
  
  """Previous version (if any)"""
  previousVersion: SpecificationVersion
  
  """Time between versions"""
  timeSincePrevious: String
}

"""Compatibility matrix entry"""
type CompatibilityInfo {
  """Source version"""
  fromVersion: String!
  
  """Target version"""
  toVersion: String!
  
  """Compatibility level"""
  compatibility: CompatibilityLevel!
  
  """Number of breaking changes"""
  breakingChangeCount: Int!
  
  """Migration available?"""
  hasMigrationGuide: Boolean!
}

type Query {
  """Get all registries"""
  registries: [SpecificationRegistry!]!
  
  """Get registry by ID"""
  registry(id: ID!): SpecificationRegistry
  
  """Get registry by name"""
  registryByName(name: String!): SpecificationRegistry
  
  """Get all versions for a registry"""
  versions(registryId: ID!): [SpecificationVersion!]!
  
  """Get specific version"""
  version(id: ID!): SpecificationVersion
  
  """Get version by semantic version string"""
  versionByNumber(registryId: ID!, version: String!): SpecificationVersion
  
  """Get current version for a registry"""
  currentVersion(registryId: ID!): SpecificationVersion!
  
  """Compare two versions"""
  compareVersions(fromVersionId: ID!, toVersionId: ID!): VersionComparison!
  
  """Get changes between versions"""
  changesBetween(fromVersionId: ID!, toVersionId: ID!): [Change!]!
  
  """Get breaking changes between versions"""
  breakingChangesBetween(fromVersionId: ID!, toVersionId: ID!): [Change!]!
  
  """Get version history timeline"""
  versionHistory(registryId: ID!): [VersionHistoryEntry!]!
  
  """Get compatibility matrix"""
  compatibilityMatrix(registryId: ID!): [[CompatibilityInfo!]!]!
  
  """Search changes by type"""
  changesByType(registryId: ID!, changeType: ChangeType!): [Change!]!
  
  """Get deprecated versions"""
  deprecatedVersions(registryId: ID!): [SpecificationVersion!]!
  
  """Validate schema compatibility"""
  validateCompatibility(baseVersionId: ID!, candidateSchema: String!): VersionComparison!
}

type Mutation {
  """Create a new registry"""
  createRegistry(
    name: String!
    description: String
    initialSchema: String!
    initialVersion: String = "1.0.0"
  ): SpecificationRegistry!
  
  """Add a new version to registry"""
  addVersion(
    registryId: ID!
    version: String!
    schema: String!
    releaseNotes: String
    author: String
  ): SpecificationVersion!
  
  """Set current version"""
  setCurrentVersion(registryId: ID!, versionId: ID!): Boolean!
  
  """Deprecate a version"""
  deprecateVersion(versionId: ID!, reason: String): Boolean!
  
  """Add tags to version"""
  addVersionTags(versionId: ID!, tags: [String!]!): Boolean!
  
  """Update registry metadata"""
  updateRegistryMetadata(
    registryId: ID!
    maintainers: [String!]
    repositoryUrl: String
    documentationUrl: String
    license: String
  ): RegistryMetadata!
}
